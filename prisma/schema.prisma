// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clerkId      String         @unique
  email        String         @unique
  firstname    String?        @unique
  lastname     String?        @unique
  createdAt    DateTime       @default(now())
  subscription Subscription?
  integrations Integrations[]
  automations  Automation[]
  
  // Streak tracking
  currentStreak Int      @default(0)
  longestStreak Int      @default(0)
  lastLoginAt   DateTime?
  
  // Marketplace
  sellerProfile SellerProfile?
  purchases     Purchase[]
  reviews       Review[]
  
  // Referral system
  referralCode     String?    @unique
  referredBy       User?      @relation("Referrals", fields: [referredById], references: [id])
  referredById     String?    @db.Uuid
  referrals        User[]     @relation("Referrals")
  referralRewards  ReferralReward[]
  
  // Feedback system
  featureRequests  FeatureRequest[]
  featureVotes     FeatureVote[]
  featureComments  FeatureComment[]
  
  // Stripe Connect (for Cold Call payouts)
  stripeConnectId       String?   @unique
  stripeConnectEnabled  Boolean   @default(false)
  stripeOnboardingComplete Boolean @default(false)
  
  // Deal Finder AI
  dealFinderProfile DealFinderProfile?
  
  // Notifications
  notifications Notification[]
}


model Subscription {
  id         String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  User       User?             @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId     String?           @unique @db.Uuid
  createdAt  DateTime          @default(now())
  plan       SUBSCRIPTION_PLAN @default(FREE)
  updatedAt  DateTime          @default(now())
  customerId String?           @unique
}

model Integrations {
  id          String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name        INTEGRATIONS @default(INSTAGRAM)
  createdAt   DateTime     @default(now())
  User        User?        @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId      String?      @db.Uuid
  token       String       @unique
  expiresAt   DateTime?
  instagramId String?      @unique
}

model Automation {
  id        String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name      String             @default("Untitled")
  createdAt DateTime           @default(now())
  active    Boolean            @default(false)
  trigger   Trigger[]
  listener  Listener?
  posts     Post[]
  dms       Dms[]
  User      User?              @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String?            @db.Uuid
  keywords  Keyword[]
  metrics   AutomationMetric[]
}

model Dms {
  id           String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  Automation   Automation? @relation(fields: [automationId], references: [id])
  automationId String?     @db.Uuid
  createdAt    DateTime    @default(now())
  senderId     String?
  reciever     String?
  message      String?
}

model Post {
  id           String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  postid       String
  caption      String?
  media        String
  mediaType    MEDIATYPE   @default(IMAGE)
  Automation   Automation? @relation(fields: [automationId], references: [id], onDelete: Cascade)
  automationId String?     @db.Uuid
}

model Listener {
  id           String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  Automation   Automation @relation(fields: [automationId], references: [id], onDelete: Cascade)
  automationId String     @unique @db.Uuid
  listener     LISTENERS  @default(MESSAGE)
  prompt       String
  commentReply String?
  dmCount      Int        @default(0)
  commentCount Int        @default(0)
}

model Trigger {
  id           String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  type         String
  Automation   Automation? @relation(fields: [automationId], references: [id], onDelete: Cascade)
  automationId String?     @db.Uuid
}

model Keyword {
  id           String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  word         String
  Automation   Automation? @relation(fields: [automationId], references: [id], onDelete: Cascade)
  automationId String?     @db.Uuid

  @@unique([automationId, word]) //this constraints ensure user cant use the same keyword on multiple automations
}

enum SUBSCRIPTION_PLAN {
  PRO
  FREE
}

enum INTEGRATIONS {
  INSTAGRAM
}

enum MEDIATYPE {
  IMAGE
  VIDEO
  CAROSEL_ALBUM
}

enum LISTENERS {
  SMARTAI
  MESSAGE
}

model AutomationMetric {
  id             String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  Automation     Automation @relation(fields: [automationId], references: [id], onDelete: Cascade)
  automationId   String     @db.Uuid
  date           DateTime
  commentsReplied Int       @default(0)
  dmsSent        Int        @default(0)
  deliveredCount Int        @default(0)

  @@unique([automationId, date])
}


// ============================================================================
// MARKETPLACE MODELS
// ============================================================================

model SellerProfile {
  id                 String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  User               User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId             String    @unique @db.Uuid
  
  // Stripe Connect
  stripeAccountId    String?   @unique
  onboardingComplete Boolean   @default(false)
  
  // Stats
  totalSales         Int       @default(0)
  totalRevenue       Int       @default(0) // in cents
  rating             Float     @default(0)
  
  products           Product[]
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt
}

model Product {
  id              String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  
  // Basic info
  name            String
  description     String          @db.Text
  price           Int             // in cents
  category        ProductCategory
  tags            String[]        // Tags for search
  
  // Seller
  SellerProfile   SellerProfile   @relation(fields: [sellerId], references: [id], onDelete: Cascade)
  sellerId        String          @db.Uuid
  
  // Stripe
  stripeProductId String?         @unique
  stripePriceId   String?         @unique
  
  // Status
  active          Boolean         @default(true)
  featured        Boolean         @default(false)
  
  // Content (stores automation config, prompts, etc.)
  content         Json
  
  // Stats
  salesCount      Int             @default(0)
  views           Int             @default(0)
  rating          Float           @default(0)
  reviewCount     Int             @default(0)
  
  // Media
  thumbnail       String?
  images          String[]
  
  purchases       Purchase[]
  reviews         Review[]
  promotions      Promotion[]
  
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  
  @@index([category])
  @@index([sellerId])
  @@index([active])
  @@index([rating])
  @@index([salesCount])
}

// Product Promotion System
model Promotion {
  id              String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  
  Product         Product         @relation(fields: [productId], references: [id], onDelete: Cascade)
  productId       String          @db.Uuid
  
  // Promotion details
  tier            PromotionTier
  boostViews      Int             // Target views to boost
  viewsDelivered  Int             @default(0)
  
  // Payment
  amount          Int             // Amount paid in cents
  stripePaymentId String?         @unique
  
  // Status
  status          PromotionStatus @default(PENDING)
  
  // Duration
  startsAt        DateTime        @default(now())
  endsAt          DateTime
  
  createdAt       DateTime        @default(now())
  
  @@index([productId])
  @@index([status])
  @@index([endsAt])
}

enum PromotionTier {
  BASIC       // $2 - 500 views, 3 days
  STANDARD    // $5 - 1500 views, 7 days  
  PREMIUM     // $10 - 5000 views, 14 days
}

enum PromotionStatus {
  PENDING
  ACTIVE
  COMPLETED
  CANCELLED
}

model Purchase {
  id              String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  
  // Buyer
  User            User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId          String         @db.Uuid
  
  // Product
  Product         Product        @relation(fields: [productId], references: [id], onDelete: Cascade)
  productId       String         @db.Uuid
  
  // Payment
  stripePaymentId String         @unique
  amount          Int            // in cents (total paid by buyer)
  platformFee     Int            // 10% platform fee
  sellerPayout    Int            // 90% to seller
  
  status          PurchaseStatus @default(PENDING)
  
  // Applied to account
  applied         Boolean        @default(false)
  appliedAt       DateTime?
  
  // Refund window (7 days)
  refundableUntil DateTime
  
  createdAt       DateTime       @default(now())
  
  @@index([userId])
  @@index([productId])
  @@index([status])
}

model Review {
  id          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  
  Product     Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  productId   String   @db.Uuid
  
  User        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId      String   @db.Uuid
  
  rating      Int      // 1-5 stars
  comment     String?  @db.Text
  
  createdAt   DateTime @default(now())
  
  @@unique([productId, userId])
  @@index([productId])
}

enum ProductCategory {
  AUTOMATION_TEMPLATE
  AI_PROMPT_PACK
  KEYWORD_LIST
  ANALYTICS_TEMPLATE
  INTEGRATION_CONFIG
}

enum PurchaseStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
}

// ============================================================================
// REFERRAL SYSTEM MODELS
// ============================================================================

model ReferralReward {
  id          String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  User        User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId      String        @db.Uuid
  
  type        RewardType
  amount      Int           // in cents for CREDIT, days for SUBSCRIPTION_EXTENSION
  description String
  claimed     Boolean       @default(false)
  claimedAt   DateTime?
  
  // Reference to what triggered this reward
  referredUserId String?    @db.Uuid
  
  createdAt   DateTime      @default(now())
  
  @@index([userId])
  @@index([claimed])
}

enum RewardType {
  CREDIT              // Account credit in cents
  SUBSCRIPTION_EXTENSION  // Extra days of pro subscription
  MARKETPLACE_DISCOUNT    // Discount on marketplace purchases
}

// ============================================================================
// FEEDBACK SYSTEM MODELS
// ============================================================================

model FeatureRequest {
  id          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  
  // Content
  title       String
  description String   @db.Text
  category    FeatureCategory
  
  // Author
  User        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId      String   @db.Uuid
  
  // Status
  status      FeatureStatus @default(PENDING)
  priority    FeaturePriority @default(LOW)
  
  // Voting
  upvotes     Int      @default(0)
  downvotes   Int      @default(0)
  score       Int      @default(0) // upvotes - downvotes for sorting
  
  // Admin response
  adminResponse String? @db.Text
  adminUserId   String? @db.Uuid
  respondedAt   DateTime?
  
  // Timestamps
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relations
  votes       FeatureVote[]
  comments    FeatureComment[]
  
  @@index([status])
  @@index([category])
  @@index([score])
  @@index([createdAt])
}

model FeatureVote {
  id        String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  
  User      User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String         @db.Uuid
  
  FeatureRequest FeatureRequest @relation(fields: [featureId], references: [id], onDelete: Cascade)
  featureId String         @db.Uuid
  
  voteType  VoteType
  createdAt DateTime       @default(now())
  
  @@unique([userId, featureId])
  @@index([featureId])
}

model FeatureComment {
  id        String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  
  content   String         @db.Text
  
  User      User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String         @db.Uuid
  
  FeatureRequest FeatureRequest @relation(fields: [featureId], references: [id], onDelete: Cascade)
  featureId String         @db.Uuid
  
  // Reply system
  parentId  String?        @db.Uuid
  parent    FeatureComment? @relation("CommentReplies", fields: [parentId], references: [id])
  replies   FeatureComment[] @relation("CommentReplies")
  
  createdAt DateTime       @default(now())
  updatedAt DateTime       @updatedAt
  
  @@index([featureId])
  @@index([parentId])
}

enum FeatureCategory {
  AUTOMATION
  INTEGRATIONS
  UI_UX
  ANALYTICS
  MARKETPLACE
  MOBILE_APP
  API
  SECURITY
  PERFORMANCE
  OTHER
}

enum FeatureStatus {
  PENDING
  UNDER_REVIEW
  PLANNED
  IN_PROGRESS
  COMPLETED
  REJECTED
}

enum FeaturePriority {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum VoteType {
  UPVOTE
  DOWNVOTE
}

// ============================================================================
// COLD CALL MODELS
// ============================================================================

model ColdCallLead {
  id              String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  
  // Business info
  businessName    String
  category        String          // restaurant, salon, plumber, etc.
  address         String?
  city            String
  state           String?
  country         String
  phone           String?
  email           String?
  
  // Online presence
  website         String?         // null = no website (our target!)
  googleMapsUrl   String?
  yelpUrl         String?
  
  // Reviews & ratings
  rating          Float?          // Google/Yelp rating
  reviewCount     Int?
  
  // Status tracking
  status          LeadStatus      @default(NEW)
  
  // Owner
  userId          String          @db.Uuid
  
  // Generated website preview
  generatedWebsite GeneratedWebsite?
  
  // Outreach history
  outreachEmails  OutreachEmail[]
  
  // Deal info
  deal            ColdCallDeal?
  
  // Notes
  notes           String?         @db.Text
  
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  
  @@index([userId])
  @@index([status])
  @@index([category])
  @@index([city])
}

model GeneratedWebsite {
  id              String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  
  ColdCallLead    ColdCallLead    @relation(fields: [leadId], references: [id], onDelete: Cascade)
  leadId          String          @unique @db.Uuid
  
  // Website content
  template        String          // restaurant, salon, etc.
  previewUrl      String?         // shareable preview link
  content         Json            // stored website config/content
  
  // Custom images (uploaded by user for client)
  customImages    String[]        // Array of image URLs (Vercel Blob)
  logoUrl         String?         // Custom logo URL
  
  // SEO settings
  seoTitle        String?         // Custom SEO title
  seoDescription  String?         // Custom meta description
  seoKeywords     String[]        // SEO keywords
  
  // Booking settings
  bookingEnabled  Boolean         @default(true)
  bookingSettings Json?           // { services: [], hours: {}, duration: 30 }
  
  // Client access
  clientAccess    ClientAccess?
  
  // Analytics & Bookings
  analytics       WebsiteAnalytics[]
  bookings        Booking[]
  services        BookingService[]
  
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
}

// ============================================================================
// CLIENT ACCESS & DASHBOARD
// ============================================================================

model ClientAccess {
  id              String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  
  GeneratedWebsite GeneratedWebsite @relation(fields: [websiteId], references: [id], onDelete: Cascade)
  websiteId       String          @unique @db.Uuid
  
  // Client credentials (simple email/password for business owner)
  email           String
  passwordHash    String
  
  // Access token for sessions
  accessToken     String?         @unique
  tokenExpiresAt  DateTime?
  
  // Settings
  emailNotifications Boolean      @default(true)
  
  lastLoginAt     DateTime?
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  
  @@index([email])
}

// ============================================================================
// BOOKING SYSTEM
// ============================================================================

model BookingService {
  id              String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  
  GeneratedWebsite GeneratedWebsite @relation(fields: [websiteId], references: [id], onDelete: Cascade)
  websiteId       String          @db.Uuid
  
  name            String          // "Haircut", "Oil Change", "Consultation"
  description     String?
  duration        Int             // in minutes
  price           Int             // in cents
  
  active          Boolean         @default(true)
  
  bookings        Booking[]
  
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  
  @@index([websiteId])
}

model Booking {
  id              String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  
  GeneratedWebsite GeneratedWebsite @relation(fields: [websiteId], references: [id], onDelete: Cascade)
  websiteId       String          @db.Uuid
  
  BookingService  BookingService? @relation(fields: [serviceId], references: [id])
  serviceId       String?         @db.Uuid
  
  // Customer info
  customerName    String
  customerEmail   String
  customerPhone   String?
  
  // Appointment details
  date            DateTime        // Date of appointment
  startTime       String          // "09:00", "14:30"
  endTime         String          // "09:30", "15:00"
  
  // Status
  status          BookingStatus   @default(PENDING)
  
  // Notes
  notes           String?         @db.Text
  
  // Confirmation
  confirmationCode String         @unique
  confirmedAt     DateTime?
  cancelledAt     DateTime?
  completedAt     DateTime?
  
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  
  @@index([websiteId])
  @@index([date])
  @@index([status])
  @@index([customerEmail])
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
  NO_SHOW
}

// ============================================================================
// WEBSITE ANALYTICS
// ============================================================================

model WebsiteAnalytics {
  id              String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  
  GeneratedWebsite GeneratedWebsite @relation(fields: [websiteId], references: [id], onDelete: Cascade)
  websiteId       String          @db.Uuid
  
  date            DateTime        @db.Date
  
  // Traffic
  pageViews       Int             @default(0)
  uniqueVisitors  Int             @default(0)
  
  // Engagement
  avgTimeOnSite   Int             @default(0) // in seconds
  bounceRate      Float           @default(0) // percentage
  
  // Conversions
  bookingClicks   Int             @default(0)
  bookingsCreated Int             @default(0)
  chatOpens       Int             @default(0)
  chatMessages    Int             @default(0)
  phoneClicks     Int             @default(0)
  
  // Sources
  directTraffic   Int             @default(0)
  referralTraffic Int             @default(0)
  
  createdAt       DateTime        @default(now())
  
  @@unique([websiteId, date])
  @@index([websiteId])
  @@index([date])
}

model OutreachEmail {
  id              String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  
  ColdCallLead    ColdCallLead    @relation(fields: [leadId], references: [id], onDelete: Cascade)
  leadId          String          @db.Uuid
  
  // Email details
  subject         String
  body            String          @db.Text
  sentAt          DateTime?
  
  // Tracking
  opened          Boolean         @default(false)
  openedAt        DateTime?
  clicked         Boolean         @default(false)
  clickedAt       DateTime?
  replied         Boolean         @default(false)
  repliedAt       DateTime?
  
  createdAt       DateTime        @default(now())
  
  @@index([leadId])
}

model ColdCallDeal {
  id              String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  
  ColdCallLead    ColdCallLead    @relation(fields: [leadId], references: [id], onDelete: Cascade)
  leadId          String          @unique @db.Uuid
  
  // Deal info
  amount          Int             // in cents
  platformFee     Int             // our cut
  sellerPayout    Int             // user's cut
  
  // Stripe
  stripeInvoiceId String?         @unique
  stripePaymentId String?         @unique
  
  status          DealStatus      @default(PENDING)
  
  paidAt          DateTime?
  createdAt       DateTime        @default(now())
  
  @@index([status])
}

enum LeadStatus {
  NEW
  CONTACTED
  INTERESTED
  NEGOTIATING
  WON
  LOST
}

enum DealStatus {
  PENDING
  PAID
  CANCELLED
  REFUNDED
}

// ============================================================================
// DEAL FINDER AI MODELS
// ============================================================================

model DealFinderProfile {
  id              String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  User            User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId          String   @unique @db.Uuid
  
  // AI learned profile
  businessType    String?  // "Graphic Designer", "Fitness Coach"
  services        String[] // ["Logo Design", "Branding"]
  targetAudience  String?  // "Startups and small businesses"
  tone            String?  // "Professional but friendly"
  priceRange      String?  // "$500-$2000"
  portfolio       String?  // Portfolio URL
  
  // Content analysis
  analyzedPosts   Int      @default(0)
  analyzedReels   Int      @default(0)
  lastAnalyzedAt  DateTime?
  
  // AI generated summary
  aiSummary       String?  @db.Text
  
  campaigns       OutreachCampaign[]
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@index([userId])
}

model OutreachCampaign {
  id              String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  DealFinderProfile DealFinderProfile @relation(fields: [profileId], references: [id], onDelete: Cascade)
  profileId       String   @db.Uuid
  
  name            String
  status          OutreachCampaignStatus @default(DRAFT)
  
  // Search criteria
  searchMode      SearchMode
  keywords        String[]
  targetFollowers String?  // "1K-10K"
  location        String?
  hashtags        String[]
  
  // Pitch
  pitchStyle      PitchStyle
  pitchTemplate   String?  @db.Text
  
  // Limits & Safety
  dailyLimit      Int      @default(50)
  totalLimit      Int?
  currentDayCount Int      @default(0)
  lastResetAt     DateTime @default(now())
  
  // Stats
  totalSent       Int      @default(0)
  totalOpened     Int      @default(0)
  totalReplied    Int      @default(0)
  totalInterested Int      @default(0)
  dealsWon        Int      @default(0)
  totalRevenue    Int      @default(0) // in cents
  
  prospects       Prospect[]
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@index([profileId])
  @@index([status])
}

model Prospect {
  id              String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  OutreachCampaign OutreachCampaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  campaignId      String   @db.Uuid
  
  // Instagram info
  username        String
  fullName        String?
  followers       Int?
  following       Int?
  postsCount      Int?
  engagementRate  Float?
  bio             String?  @db.Text
  email           String?
  website         String?
  profilePicUrl   String?
  isVerified      Boolean  @default(false)
  isBusinessAccount Boolean @default(false)
  
  // Discovery
  foundVia        String   // "hashtag", "competitor", "problem_post", "location"
  sourcePost      String?  // URL of post that triggered discovery
  sourcePostCaption String? @db.Text
  painPoint       String?  @db.Text // What problem they have
  relevanceScore  Float?   // 0-100 how relevant they are
  
  // Outreach
  status          ProspectStatus @default(FOUND)
  pitchSent       String?  @db.Text // The actual DM sent
  sentAt          DateTime?
  openedAt        DateTime?
  repliedAt       DateTime?
  lastFollowUpAt  DateTime?
  followUpCount   Int      @default(0)
  
  // Deal
  interested      Boolean  @default(false)
  dealClosed      Boolean  @default(false)
  dealAmount      Int?     // in cents
  dealClosedAt    DateTime?
  
  // Notes
  notes           String?  @db.Text
  
  messages        ProspectMessage[]
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@index([campaignId])
  @@index([status])
  @@index([username])
}

model ProspectMessage {
  id          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  Prospect    Prospect @relation(fields: [prospectId], references: [id], onDelete: Cascade)
  prospectId  String   @db.Uuid
  
  content     String   @db.Text
  sender      MessageSender
  sentAt      DateTime @default(now())
  read        Boolean  @default(false)
  
  @@index([prospectId])
  @@index([sentAt])
}

enum OutreachCampaignStatus {
  DRAFT
  ACTIVE
  PAUSED
  COMPLETED
  ARCHIVED
}

enum SearchMode {
  PROBLEM_POSTS      // People asking for help
  COMPETITOR_FOLLOWERS
  HASHTAG_MINING
  LOCATION_BASED
  WEBSITE_SCRAPING
  MANUAL_UPLOAD      // User provides list
}

enum PitchStyle {
  PROBLEM_SOLVER     // "Saw you need X, I can help"
  SOCIAL_PROOF       // "Just helped someone like you"
  VALUE_FIRST        // "Here's a free tip for you"
  CURIOSITY          // "Quick question about your business"
  DIRECT_OFFER       // "I do X for $Y, interested?"
  CUSTOM             // User writes their own
}

enum ProspectStatus {
  FOUND              // Discovered but not contacted
  QUEUED             // Ready to send DM
  DM_SENT            // Initial DM sent
  OPENED             // They read the DM
  REPLIED            // They responded
  INTERESTED         // Positive response
  NEGOTIATING        // Discussing terms
  DEAL_CLOSED        // Agreement reached
  NOT_INTERESTED     // Declined
  GHOSTED            // No response after follow-ups
  BLOCKED            // They blocked us
  ARCHIVED           // Manually archived
}

enum MessageSender {
  USER
  PROSPECT
  SYSTEM
}

// ============================================================================
// NOTIFICATION SYSTEM
// ============================================================================

model Notification {
  id          String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  User        User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId      String           @db.Uuid
  
  type        NotificationType
  title       String
  message     String
  read        Boolean          @default(false)
  
  // Optional link to related entity
  linkUrl     String?
  
  createdAt   DateTime         @default(now())
  
  @@index([userId])
  @@index([read])
  @@index([createdAt])
}

enum NotificationType {
  DM_SENT           // Automation sent a DM
  COMMENT_REPLY     // Automation replied to comment
  AUTOMATION_TRIGGER // Keyword triggered
  SYSTEM            // System notifications
  UPGRADE           // Upgrade prompts
}


// ============================================================================
// USER EMAIL SETTINGS (Gmail OAuth)
// ============================================================================

model UserEmailSettings {
  id              String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId          String   @unique @db.Uuid
  
  // Gmail OAuth tokens
  gmailEmail      String?
  accessToken     String?  @db.Text
  refreshToken    String?  @db.Text
  tokenExpiry     DateTime?
  
  // Display settings
  senderName      String?
  
  // Status
  connected       Boolean  @default(false)
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}
